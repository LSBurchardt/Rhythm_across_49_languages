---
title: "DoReCo Rhythms"
author: "Lara S. Burchardt"
date: "`r Sys.Date()`"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE, warning = FALSE, message = FALSE)
```

## DoReCo Rhythms

We analyse the rhythms of the DoReCo languages on two levels: on the IPU level (interpausal Units)
and the word level of each language. 

The results are presented visually in this Document. 

Whenever an 'ioi beat' is presented, it is in Hertz. The unbiased CV is the coefficient of variation adjusted for small sample sizes. The CV is the standard deviation divided by the mean. 

This is a first attempt of providing helpful visualizations to decide on further analysis or to guide future decisions on what to plot, the plots are to be considered drafts and any feedback is welcome. 


```{r preparation, include = FALSE}
# packages -----
if (!require(install.load)) {
  install.packages("install.load")
}

library(install.load)

install_load("tidyverse", "psych", "tidygeocoder", "countrycode", "devtools")
```



```{r data_load, eval=FALSE, include = FALSE}
# load data ----- 

# meta data languages

languages_meta <- read_delim("doreco_languages_metadata_v1.3.csv", delim = ",")

# meta data files

meta_data_file <- read_delim("unsplit_ipu_data_for_rhythm_analysis_including_meta_data_run_April24.csv", delim = ",")

# meta data, morphologic complexity + ton language information

meta_data_morph_tone <- read_delim("Typo_Info_Rhythm_Project.csv", delim = ";")
meta_data_morph_tone <- meta_data_morph_tone %>% 
  select(Language, Glottocode, `Complexity `, Tone) %>% 
  mutate(Complexity = `Complexity `)

# word data ----

# path <- "language_data_word/results"
# pattern <- "csv"
# 
# list_of_files_word <- list.files(path = path, pattern = pattern)
# 
# rhythm_results_doreco_word <- data.frame(matrix(ncol = 24, nrow = 0))
# 
# for (a in 1:length(list_of_files_word)){
#   
#  data <- read_delim(paste(path, list_of_files_word[a], sep = "\\")) 
#   
#  rhythm_results_doreco_word <- rbind(rhythm_results_doreco_word, data)
#   
# }

## 02: add meta data, word ----


# for(i in 1:length(rhythm_results_doreco_word$filename)){
#   names <- str_split(rhythm_results_doreco_word$filename[i], pattern = "_")
#   names <- names[[1]]
#   rhythm_results_doreco_word$language[i] <- names[[3]]
#   rhythm_results_doreco_word$Glottocode[i] <- names[[3]]
#   rhythm_results_doreco_word$speaker[i] <- names[[7]]
#   rhythm_results_doreco_word$speaker[i] <- substring(rhythm_results_doreco_word$speaker[i], 1, nchar(rhythm_results_doreco_word$speaker[i])-4)
#   rhythm_results_doreco_word$type[i] <- names[[1]]
#   rhythm_results_doreco_word$file[i] <- names[[5]]   #filename from raw file, to use to join rhythm results with meta data file
# }

#  meta data like speaker sex and speaker age needs to be extracted/joined from raw data extraction from Database

meta_data_file <- meta_data_file %>% 
  select(file, Speaker_Age, Speaker_Sex)

rhythm_results_doreco_word_meta <- left_join(rhythm_results_doreco_word, meta_data_file, by = "file", multiple = "any")

rhythm_results_doreco_word_meta<- left_join(rhythm_results_doreco_word_meta, languages_meta, by = "Glottocode", multiple = "any")

rhythm_results_doreco_word_meta<- left_join(rhythm_results_doreco_word_meta, meta_data_morph_tone, by = "Glottocode", multiple = "any")

# for visualization we also produce a dataset where languages are ordered by median ioi-beat

group_ordered_word <- with(rhythm_results_doreco_word_meta,                   # Order boxes by median
                      reorder(Language,
                              ioi_beat,
                              median))

rhythm_results_doreco_word_ordered <- rhythm_results_doreco_word_meta                              
# Create data with reordered group levels
rhythm_results_doreco_word_ordered$Language <- factor(rhythm_results_doreco_word_ordered$Language,
                             levels = levels(group_ordered_word))

# ipu data -----

# path <- "language_data/results"
# pattern <- "csv"
# 
# list_of_files_ipu <- list.files(path = path, pattern = pattern)
# 
# rhythm_results_doreco_ipu <- data.frame(matrix(ncol = 24, nrow = 0))
# 
# for (a in 1:length(list_of_files_ipu)){
#   
#  data <- read_delim(paste(path, list_of_files_ipu[a], sep = "\\")) 
#   
#  rhythm_results_doreco_ipu <- rbind(rhythm_results_doreco_ipu, data)
# }

rhythm_results_doreco_ipu <- read_delim("language_data/results/rhythm_analysis_doreco_ipu_mean_apr24_fs_20.csv", delim = ",")

 for(i in 1:length(rhythm_results_doreco_ipu$filename)){
  names <- str_split(rhythm_results_doreco_ipu$filename[i], pattern = "_")
  names <- names[[1]]
  rhythm_results_doreco_ipu$language[i] <- names[[3]]
  rhythm_results_doreco_ipu$Glottocode[i] <- names[[3]]
  rhythm_results_doreco_ipu$speaker[i] <- names[[7]]
  rhythm_results_doreco_ipu$speaker[i] <- substring(rhythm_results_doreco_ipu$speaker[i], 1, nchar(rhythm_results_doreco_ipu$speaker[i])-4)
  rhythm_results_doreco_ipu$type[i] <- names[[1]]
  rhythm_results_doreco_ipu$file[i] <- names[[5]]   #filename from raw file, to use to join rhythm results with meta data file
}

#  meta data like speaker sex and speaker age needs to be extracted/joined from raw data extraction from Database

rhythm_results_doreco_ipu_meta <- left_join(rhythm_results_doreco_ipu, meta_data_file, by = "file", multiple = "any")

rhythm_results_doreco_ipu_meta <- left_join(rhythm_results_doreco_ipu_meta, languages_meta, by = "Glottocode", multiple = "any")
  
rhythm_results_doreco_ipu_meta<- left_join(rhythm_results_doreco_ipu_meta, meta_data_morph_tone, by = "Glottocode", multiple = "any")



```

```{r data_prep, eval = FALSE}
for(a in 1:nrow(rhythm_results_doreco_ipu_meta)){
#  for(a in 1:5){
  lat_longs <- tibble::tribble(
  ~latitude,        ~longitude,
   rhythm_results_doreco_ipu_meta$Latitude[a],           rhythm_results_doreco_ipu_meta$Longitude[a]
)
  
reverse <-  lat_longs %>%
  reverse_geocode(lat = latitude, long = longitude, method = 'osm',
                  address = address_found, full_results = TRUE) %>%
  select(country, country_code)

rhythm_results_doreco_ipu_meta$country[a] <- reverse$country
rhythm_results_doreco_ipu_meta$country_code[a] <- reverse$country_code

country_name_eng <- countrycode(reverse$country_code, "iso2c", "country.name")

rhythm_results_doreco_ipu_meta$country_eng[a] <- country_name_eng

rm(reverse)

}
```

```{r data_prep_2, eval = FALSE}

#join height information from Baten & Blum (2015) dataset with rhythm results
# https://clio-infra.eu/Indicators/Height.html downloaded from here, only column names were
# changed slightly to fit the format 
# Myanmar was renamed to "Myanmar(Burma)" as it was named like that in the geocoding lists


heights <- read_delim("average-height-of-men-for-selected-countries.csv", delim = ";")

heights <- heights %>% 
  select(country_eng, Year, Height)

heights_avg <- heights %>%
  group_by(country_eng) %>%
  summarise(avg_height = mean(Height, na.rm = TRUE))


rhythm_results_doreco_ipu_meta<- left_join(rhythm_results_doreco_ipu_meta, heights_avg, by = "country_eng", multiple = "any")

# use data from ipu dataframe to add country and height information to the word dataframe as well
# we split the ipu dataframe, selecting only the relevant data: longitude,lattitude, country, country_eng, avg_height

country_height_info <- rhythm_results_doreco_ipu_meta %>% 
  select(Longitude, Latitude, country, country_code, country_eng, avg_height)

rhythm_results_doreco_word_meta <- left_join(rhythm_results_doreco_word_meta, country_height_info, by = c("Longitude", "Latitude"), multiple = "any")



#saveRDS(rhythm_results_doreco_word_meta, file = "rhythm_results_doreco_word_meta.rds")
saveRDS(rhythm_results_doreco_ipu_meta, file = "rhythm_results_doreco_ipu_meta.rds")

```

```{r elevation, eval = FALSE, echo = FALSE, include = FALSE}
#check next: adding elevation levels of coordinates with the "elevatr" package 
# i think this package only works with locations in the US though...
# 
# 
# # install.packages("devtools")
# devtools::install_github("markusdumke/altituder")
# 
# get_altitude(.Data, .longitude = NULL, .latitude = NULL,
#   .src = c("racemap", "geonames", "google", "openelevation"),
#   .geonames.username = "demo", .google.api.key = NULL)
# 
# 
# # Install and load the elevatr package
# install.packages("elevatr")
# library(elevatr)
# 
# # Example coordinates
# coordinates <- data.frame(
#   latitude = c(37.7749, 48.8566, -34.397),
#   longitude = c(-122.4194, 2.3522, 150.644)
# )
# 
# # Query elevation data
# elevation_data <- elevatr::get_elev_point(coordinates)
# 
# # Print the result
# print(elevation_data)
# 
# get_altitude(Data, .src = "openelevation")

```


```{r load_final_data}
# in this chunk we load the final data version, that we prepared in the chunks above and saved in lines 213 and 214
# as these preparations need some time to calculate, we here give the option to knit the document faster, by loading the final dataframes from .rds

rhythm_results_doreco_ipu_meta <- readRDS("rhythm_results_doreco_ipu_meta.rds")

rhythm_results_doreco_ipu_meta <- rhythm_results_doreco_ipu_meta %>% 
  mutate(Language = Language.x) %>% 
  select(-Language.y, -Language.x)

rhythm_results_doreco_word_meta <- readRDS("rhythm_results_doreco_word_meta.rds")

rhythm_results_doreco_word_meta <- rhythm_results_doreco_word_meta %>% 
  mutate(Language = Language.x) %>% 
  select(-Language.y, -Language.x)

```

```{r ipu_filter}
# some files seem to have flawed raw data, we filter them out until we know what is going on
# file: "ipu_language_resi1247_file_doreco-resi1247-storyalicia_speaker_resi1247-OG_runapr24.csv"

rhythm_results_doreco_ipu_meta <- rhythm_results_doreco_ipu_meta %>% 
  filter(filename != "ipu_language_resi1247_file_doreco-resi1247-storyalicia_speaker_resi1247-OG_runapr24.csv")
  
# This is a short term solution, to filter out datafiles with ioi beats < 0.2, because there are likely long silent pauses
#these need to be dealt with consistently, best: split files and reanalyse
# it is only 6 datapoints with ioi beat < 0.2


#rhythm_results_doreco_ipu_meta_unfiltered <- rhythm_results_doreco_ipu_meta #backup copy

rhythm_results_doreco_ipu_meta <- rhythm_results_doreco_ipu_meta %>% 
  filter(ioi_beat>0.2)

```

```{r ordered}
# for visualization we also produce a dataset where languages and language family are ordered by median ioi-beat

## IPU Level

# Calculate median ioi_beat per language
median_ioi_lan <- rhythm_results_doreco_ipu_meta %>%
  group_by(Language) %>%
  summarize(median_ioi_beat = median(ioi_beat, na.rm = TRUE))

# Calculate median ioi_beat per language family
median_ioi_fam <- rhythm_results_doreco_ipu_meta %>%
  group_by(Family) %>%
  summarize(median_ioi_beat = median(ioi_beat, na.rm = TRUE))

# copy dataframe
rhythm_results_doreco_ipu_ordered <- rhythm_results_doreco_ipu_meta 

# Reorder the levels of Language based on median ioi_beat
rhythm_results_doreco_ipu_ordered$Language <- factor(rhythm_results_doreco_ipu_ordered$Language,
                                                     levels = median_ioi_lan$Language[order(median_ioi_lan$median_ioi_beat)])
rhythm_results_doreco_ipu_ordered$Family <- factor(rhythm_results_doreco_ipu_ordered$Family,
                                                     levels = median_ioi_fam$Family[order(median_ioi_fam$median_ioi_beat)])


## WORD Level
# group_ordered_word <- with(rhythm_results_doreco_word_meta,                     # Order boxes by median
#                       reorder(Language,
#                               ioi_beat,
#                               median))

#rhythm_results_doreco_word_ordered <- rhythm_results_doreco_word_meta                              
# Create data with reordered group levels
#rhythm_results_doreco_word_ordered$Language <- factor(rhythm_results_doreco_word_ordered$Language,
 #                            levels = levels(group_ordered_ipu))
```


## Data Summary

```{r map}
# map plot, where are languages spoken?
unique_coords <- unique(rhythm_results_doreco_ipu_meta[, c("Latitude", "Longitude")])

# Create a dataframe with unique coordinates
unique_coords_df <- data.frame(
  lon = unique_coords$Longitude,
  lat = unique_coords$Latitude)


map_world <- ggplot2::map_data('world')
land.colour   <- "grey75"
border.colour <- "grey10"
basemap= map_world
xmin= -140
xmax= 180
ymin= -50
ymax= 75

map <- ggplot() +
  coord_quickmap(xlim=c(xmin, xmax), ylim=c(ymin, ymax)) +
  geom_polygon(data=basemap, aes(x=long, y=lat, group=group), fill=land.colour, colour = border.colour, lwd=.5)+
  geom_point(data = unique_coords_df, aes(x = lon, y = lat), color = "red", size = 2) +  # Add points
  ylab("Latitute [°]")+
  xlab("Longitude [°]")+
  ggtitle("Where are the languages spoken?")

map
```

### IPU Level

```{r summary_ipu}

rhythm_results_doreco_ipu_meta %>%
  select('ioi_beat', 'unbiased_cv', 'npvi', 'fourier_beat', 'n_elements') %>% 
  summary(na.rm = TRUE)
```

### Word Level

```{r summary_word}
# rhythm_results_doreco_word_meta %>% 
#   select('ioi_beat', 'unbiased_cv', 'npvi', 'fourier_beat', 'n_elements') %>% 
#   summary()

```

## Visualizations

The same visualizations are produced for both levels. We plot IOI beat and Coefficient of Variation on the whole dataset, and divided into male and female identifying speakers. Furthermore we show the ioi rhythm for each language and per language family. Histograms of ioi beats and cvs are also shown per level. 

### IPU Level

```{r ioi_cv_ipu}

# rhythm_results_doreco_ipu_meta %>% 
#   ggplot(aes(y = ioi_beat))+
#   geom_boxplot()+
#   theme_minimal()+
#   xlab("IPU Level")

rhythm_results_doreco_ipu_meta %>% 
  ggplot(aes(x= ioi_beat))+
  geom_histogram(aes(y=stat((count)/sum(stat(count))*100)),
               color = "white", fill = "darkblue")+
  theme_minimal()+
  ylab("Percentage [%]")+
  xlab("IPU Beat [Hz]")

# rhythm_results_doreco_ipu_meta %>% 
#   ggplot(aes(y = unbiased_cv))+
#   geom_boxplot(outlier.shape = NA)+
#   coord_cartesian(ylim = c(0,3))+
#   theme_minimal()+
#   xlab("IPU Level")+
#   theme(axis.text.x = element_blank())

rhythm_results_doreco_ipu_meta %>% 
  ggplot(aes(x= unbiased_cv))+
  geom_histogram(aes(y=stat((count)/sum(stat(count))*100)),
               color = "white", fill = "darkblue", binwidth = 0.25)+
  theme_minimal()+
  ylab("Percentage [%]")+
  xlab("CV of IPU Durations")

```

Now we plot IOI Beat [Hz] for the IPU Level per language and per language family. 

```{r languages_ipu}

colors <- c("#1f77b4", "#ff7f0e", "#2ca02c", "#d62728", "#9467bd", "#8c564b", 
            "#e377c2", "#7f7f7f", "#bcbd22", "#17becf", "#1f77b4", "#aec7e8", 
            "#ff7f0e", "#ffbb78", "#2ca02c", "#98df8a", "#d62728", "#ff9896", 
            "#9467bd", "#c5b0d5", "#8c564b", "#c49c94", "#e377c2", "#f7b6d2", 
            "#7f7f7f", "#c7c7c7", "#bcbd22", "#dbdb8d")

rhythm_results_doreco_ipu_ordered %>%
  dplyr::filter(is.na(ioi_beat) == FALSE) %>% 
  group_by(speaker.y, Language) %>% 
  ggplot(aes(y = ioi_beat, x = Language, fill = Family))+
  geom_boxplot()+
  geom_jitter(alpha = 0.2)+
  theme_minimal()+
   scale_fill_manual(values = colors)+
  theme(#legend.position = "none",
        axis.text.x = element_text(angle = 90, hjust = 1, vjust = -0.1),
         legend.title = element_blank(),
        legend.text = element_text(size = 7),
        legend.key.size = unit(0.35, 'cm'))+
  xlab("Languages")+
  ylab("IPU Beat [Hz]")


rhythm_results_doreco_ipu_ordered %>%
  dplyr::filter(is.na(ioi_beat) == FALSE) %>%
  dplyr::filter(Family != "Isolate") %>% 
  group_by(speaker.y,Family) %>% 
  ggplot(aes(y = ioi_beat, x = Family, fill = Tone))+
  geom_boxplot()+
  geom_jitter(alpha = 0.2)+
  theme_minimal()+
  theme(#legend.position = "none",
        axis.text.x = element_text(angle = 90, hjust = 1, vjust = -0.1),
        legend.title = element_blank(),
        legend.text = element_text(size = 8),
        legend.key.size = unit(0.4, 'cm'))+
  xlab("Language Family")+
  ylab("IPU Beat [Hz]")

```

```{r sex_ipu, echo = FALSE, include=FALSE}

rhythm_results_doreco_ipu_meta %>%
  drop_na(speaker_sex) %>%
  group_by(speaker.y) %>% 
  ggplot(aes(y = ioi_beat, x = speaker_sex, fill = speaker_sex))+
  geom_boxplot()+
  #geom_jitter(aes( color = Language))
  theme_minimal()+
  xlab("IPU Level")

  rhythm_results_doreco_ipu_meta %>%
  drop_na(speaker_sex) %>%
  group_by(speaker.y) %>%  
  ggplot(aes(y = unbiased_cv, x = speaker_sex, fill = speaker_sex))+
  geom_boxplot(outlier.shape = NA)+
  coord_cartesian(ylim = c(0,1))+
  #geom_jitter(aes( color = Language))
  theme_minimal()+
  xlab("IPU Level")
  
  rhythm_results_doreco_ipu_meta %>%
  drop_na(speaker_sex) %>%
  group_by(speaker.y) %>% 
  ggplot(aes(y = npvi, x = speaker_sex, fill = speaker_sex))+
  geom_boxplot()+
  #coord_cartesian(ylim = c(0,1))+
  #geom_jitter(aes( color = Language))
  theme_minimal()+
  xlab("IPU Level")

```

We also want to visualize the effect of age on the IOI Beat on the IPU Level.

```{r age_median_ipu}

# medium ioi beat per language vs. medium age per language
median_data <- aggregate(cbind(speaker_age, ioi_beat) ~ Language, data = rhythm_results_doreco_ipu_meta, median)

# Create a scatter plot with median ioi_beat against median age
ggplot(median_data, aes(x = speaker_age, y = ioi_beat)) +
  geom_point() +
  geom_smooth(method = "lm")+
  labs(title = "Median IPU Beat [Hz] vs. Median Age per Language",
       x = "Median Age",
       y = "Median IPU beat [Hz]") +
  theme_minimal()


```

```{r age_facet_ipu, fig.height=40, include=FALSE, echo=FALSE}

rhythm_results_doreco_ipu_meta %>% 
  ggplot(aes(x= speaker_age, y = ioi_beat ))+
  geom_jitter(aes(fill = Language, color = Language))+
  geom_smooth(method = "lm")+
  facet_grid(rows = vars(Family))+
  theme_minimal()+
  xlab('Speaker Age ')+
  ylab("IPU beat [Hz]")

```


```{r age_ipu}
rhythm_results_doreco_ipu_meta %>% 
  ggplot(aes(x= speaker_age, y = ioi_beat ))+
  geom_jitter(aes(fill = Language, color = Language))+
  geom_smooth(method = "lm")+
  theme_minimal()+
  theme(legend.position = "none")+
  xlab('Speaker Age ')+
  ylab("IPU beat [Hz]")

```

Next we check for any effect of morphological complexity and a potential difference
between tonal and non-tonal languages.

```{r typo_info_ipu}

rhythm_results_doreco_ipu_meta %>%
  filter(is.na(Tone) == FALSE) %>%
  group_by(speaker.y) %>% 
  ggplot(aes(x= Tone, y = ioi_beat ))+
  geom_boxplot()+
  geom_jitter(size= 0.5, alpha = 0.5)+
  theme_minimal()+
  theme(legend.position = "none")+
  xlab(' Tonal Language')+
  ylab("IPU beat [Hz]")
  
rhythm_results_doreco_ipu_meta %>%
  group_by(speaker.y) %>% 
  ggplot(aes(x= Complexity, y = ioi_beat, group = Complexity ))+
  geom_boxplot()+
  geom_jitter(size= 0.5, alpha = 0.5)+
  theme_minimal()+
  theme(legend.position = "none")+
  xlab(' Morphological Complexity ')+
  ylab("IPU beat [Hz]")


```

What can we say about different areas of the world?

```{r area_ipu}

rhythm_results_doreco_ipu_meta %>% 
  ggplot(aes(x= Area, y = ioi_beat ))+
  geom_boxplot()+
  geom_jitter(size= 0.5, alpha = 0.5)+
  theme_minimal()+
  theme(legend.position = "none")+
  xlab(' Area')+
  ylab("IPU beat [Hz]")



```

And how does the IOI Beat relate to the average height of people in the country where this language is spoken?

```{r height_ipu}

rhythm_results_doreco_ipu_meta %>% 
  ggplot(aes(x= avg_height, y = ioi_beat ))+
  geom_jitter(alpha = 0.5, aes(color = Area))+
  geom_smooth(method = "lm")+
  theme_minimal()+
  xlab('Average Height per Country [cm]')+
  ylab("IPU beat [Hz]")


```

### Word Level

```{r ioi_cv_word}

# rhythm_results_doreco_word_meta %>% 
#   ggplot(aes(y = ioi_beat))+
#   geom_boxplot()+
#   theme_minimal()+
#   xlab("Word Level")
# 
# rhythm_results_doreco_word_meta %>% 
#   ggplot(aes(x= ioi_beat))+
#   geom_histogram(aes(y=stat((count)/sum(stat(count))*100)),
#                color = "white", fill = "darkblue", binwidth = 0.25)+
#   theme_minimal()+
#   ylab("Percentage [%]")+
#   xlab("IOI Beat [Hz] -  Word Level")
# 
# rhythm_results_doreco_word_meta %>% 
#   ggplot(aes(y = unbiased_cv))+
#   geom_boxplot(outlier.shape = NA)+
#   coord_cartesian(ylim = c(0,3))+
#   theme_minimal()+
#   xlab("Word Level")+
#   theme(axis.text.x = element_blank())
# 
# rhythm_results_doreco_word_meta %>% 
#   ggplot(aes(x= unbiased_cv))+
#   geom_histogram(aes(y=stat((count)/sum(stat(count))*100)),
#                color = "white", fill = "darkblue", binwidth = 0.25)+
#   theme_minimal()+
#   ylab("Percentage [%]")+
#   xlab("CV - Word Level")

```

% Now we plot the IOI Beat [Hz] for the word level per language and per language family. 

```{r languages_word}

# rhythm_results_doreco_word_ordered %>%
#   dplyr::filter(is.na(ioi_beat) == FALSE) %>% 
#   #group_by(Family) %>% 
#   ggplot(aes(y = ioi_beat, x = Language, fill = Language))+
#   geom_boxplot()+
#   geom_jitter(alpha = 0.2)+
#   theme_minimal()+
#    theme(legend.position = "bottom",
#         axis.text.x = element_text(angle = 90, hjust = 1, vjust = -0.1),
#         legend.title = element_blank(),
#         legend.text = element_text(size = 7),
#         legend.key.size = unit(0.35, 'cm'))+
#   xlab("Languages")
# 
# rhythm_results_doreco_word_ordered %>%
#   dplyr::filter(is.na(ioi_beat) == FALSE) %>% 
#   group_by(Family) %>% 
#   ggplot(aes(y = ioi_beat, x = Family, fill = Family))+
#   geom_boxplot()+
#   geom_jitter(alpha = 0.2)+
#   theme_minimal()+
#  theme(legend.position = "bottom",
#         axis.text.x = element_text(angle = 90, hjust = 1, vjust = -0.1),
#         legend.title = element_blank(),
#         legend.text = element_text(size = 8),
#         legend.key.size = unit(0.4, 'cm'))+
#   xlab("Language Family")

```



```{r sex_word, include=FALSE, echo = FALSE}

  # rhythm_results_doreco_word_meta %>%
  # drop_na(Speaker_Sex) %>% 
  # ggplot(aes(y = ioi_beat, x = Speaker_Sex, fill = Speaker_Sex))+
  # geom_boxplot()+
  # #geom_jitter(aes( color = Language))
  # theme_minimal()+
  # xlab("Word Level")
  # 
  # rhythm_results_doreco_word_meta %>%
  # drop_na(Speaker_Sex) %>% 
  # ggplot(aes(y = unbiased_cv, x = Speaker_Sex, fill = Speaker_Sex))+
  # geom_boxplot(outlier.shape = NA)+
  # coord_cartesian(ylim = c(0,3))+
  # #geom_jitter(aes( color = Language))
  # theme_minimal()+
  # xlab("Word Level")
  # 
  # rhythm_results_doreco_word_meta %>%
  # drop_na(Speaker_Sex) %>% 
  # ggplot(aes(y = npvi, x = Speaker_Sex, fill = Speaker_Sex))+
  # geom_boxplot()+
  # #coord_cartesian(ylim = c(0,1))+
  # #geom_jitter(aes( color = Language))
  # theme_minimal()+
  # xlab("Word Level")

```

% We also want to visualize the effect of age on the IOI Beat on the Word Level. 

```{r age_median_word}

# # medium ioi beat per language vs. medium age per language
# median_data_word <- aggregate(cbind(Speaker_Age, ioi_beat) ~ Language, data = rhythm_results_doreco_word_meta, median)
# 
# # Create a scatter plot with median ioi_beat against median age
# ggplot(median_data_word, aes(x = Speaker_Age, y = ioi_beat)) +
#   geom_point() +
#   geom_smooth(method = "lm")+
#   labs(title = "Median IOI Beat [Hz] vs. Median Age per Language -- Word Level",
#        x = "Median Age",
#        y = "Median IOI beat [Hz]") +
#   theme_minimal()


```

```{r age_facet_word, fig.height=40, include=FALSE}

# rhythm_results_doreco_word_meta %>% 
#   ggplot(aes(x= Speaker_Age, y = ioi_beat ))+
#   geom_jitter(aes(fill = language, color = language))+
#   geom_smooth(method = "lm")+
#   facet_grid(rows = vars(Family))+
#   theme_minimal()+
#   xlab('Speaker Age - Word Level')
```


```{r age_word}
# rhythm_results_doreco_word_meta %>% 
#   ggplot(aes(x= Speaker_Age, y = ioi_beat ))+
#   geom_jitter(aes(fill = language, color = language))+
#   geom_smooth(method = "lm")+
#   theme_minimal()+
#   theme(legend.position = "none")+
#   xlab('Speaker Age - Word Level')

```

% Next we check for any effect of morphological complexity and a potential difference
% between tonal and non-tonal languages.

```{r typo_info_word}

# rhythm_results_doreco_word_meta %>% 
#   ggplot(aes(x= Tone, y = ioi_beat ))+
#   geom_boxplot()+
#   geom_jitter(size= 0.5, alpha = 0.5)+
#   theme_minimal()+
#   theme(legend.position = "none")+
#   xlab(' Tonal Language --  Word Level')
# 
# rhythm_results_doreco_word_meta %>% 
#   ggplot(aes(x= Complexity, y = ioi_beat, group = Complexity ))+
#   geom_boxplot()+
#   geom_jitter(size= 0.5, alpha = 0.5)+
#   theme_minimal()+
#   theme(legend.position = "none")+
#   xlab(' Morphological Complexity -- Word Level')


```


% What can we say about different areas of the world on the word level?

```{r area_word}

# rhythm_results_doreco_word_meta %>% 
#   ggplot(aes(x= Area, y = ioi_beat ))+
#   geom_boxplot()+
#   geom_jitter(size= 0.5, alpha = 0.5)+
#   theme_minimal()+
#   theme(legend.position = "none")+
#   xlab(' Area --  Word Level')



```

% And how does the IOI Beat on word level relate to the average height of people in the country where this language is spoken?

```{r height_word}

# rhythm_results_doreco_word_meta %>% 
#   ggplot(aes(x= avg_height, y = ioi_beat ))+
#   geom_jitter(alpha = 0.5, aes(color = Area))+
#   theme_minimal()+
#   xlab('Average Height per Country [cm]')
#   ylab(' IOI Beat [Hz] -- Word Level' )


```




# Analysis Ideas

We can look at the ratio between word ioi beat and ipu ioi beat, eyeballing with means, there is around 3 words per ipu on average, but I guess there is differences between the languages there. 

# Interpretations/Thoughts

The ipu beat mostly ranges between 0.4 and 0.6 Hz, while word beats mostly range between 0.5 and 2.5, so the difference in ipu beats is around 1.5 fold, while for words it is about 5 fold. It was expected, that we see much higher variability on the word level. This is apparent in ioi beats as well as in coefficients of variations within sequences. 

Interestingly, individual sequence rhythms pooled from all language seem to follow normal distributions on the ipu level as well as the word level though, this hints at underlying biomechanical/perceptual reasons for rhythms in that range. 

Do these in fact fit with perceptual "optimal rates" found for humans? 

Can we say something about outliers?

What about the slight sex differences? Why are men faster? Is that significant? What is the effect size?

Can we model what has the biggest effect on the rhythm of an individual? Is it language/language family/sex/age? Is there a difference between the model for ipu and word level? I would expect the model to show a bigger importance of "biological parameters" such as sex and age for the ipu level, while it should be stronger influenced by language and language family on the word level. 

- is there model data on theoretical lung volumes that humans can have? and a connection to breathing rates? if our data overlaps with this modelling, what would that mean? 
